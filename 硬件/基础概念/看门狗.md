# 硬件基础概念——看门狗

## 需求产生原因

在由单片机构成的微型计算机系统中，由于单片机的工作常常会受到来自外界电磁场的干扰，造成各种寄存器和内存的数据混乱，会导致程序指针错误，不在程序区，取出错误的程序指令等，都有可能会陷入死循环，程序的正常运行被打断，由单片机控制的系统无法继续正常工作，导致整个系统的陷入停滞状态，发生不可预料的后果。

## 定义

看门狗，又叫`watchdog timer`，是一个`定时器电路`，一般有一个输入，叫`喂狗(kicking the dog/service the dog`），`一个输出到MCU的RST端`，MCU 正常工作的时候，每隔一段时间输出一个信号到喂狗端，给 WDT 清零，如果超过规定的时间不喂狗（一般在程序跑飞时），WDT 定时超过，就会给出一个复位信号到 MCU，使 MCU 复位。防止 MCU 死机. 看门狗的作用就是防止程序发生死循环，或者说程序跑飞。

## 基本原理

看门狗是一种`监控系统的运行状况的手段`，通过软硬件结合的方式实现对系统运行状况的监控。稳定运行的软件会在执行完特定指令后进行喂狗，若在一定周期内看门狗没有收到来自软件的喂狗信号，则认为系统故障，会进入中断处理程序或强制系统复位。系统上电后根据不同的工作模式可以选择使能看门狗的时机，若看门狗被使能则计数器开始计数，如果在设定的时间内没有及时喂狗则会发生看门狗超时。

## 主要构成

看门狗主要由`寄存器`、`计数器`和`狗叫模块`构成。

| 模块     | 作用                                 |
| -------- | ------------------------------------ |
| 寄存器   | 对看门狗进行基本设置                 |
| 计数器   | 计算狗叫时间                         |
| 狗叫模块 | 决定看门狗超时后发出的中断或复位方式 |
