# Prisma 最佳实践

`PS：` **仅个人意见**

## Code First

社会在发展，时代在进步，以前看起来很主流的东西随着时间的演化可能会暴露出来越来越多的缺点，最终长江后浪推前浪，前浪死在沙滩上！

在早期，为了足够的安全起见，代码是不允许更改数据库表结构的，只有 `crud` 的权限。对于要更新表结构的部署，需要先 `migration` ，得到迁移 `SQL` ，之后在数据库中运行 `SQL` 文件，主动更新表结构。这样确实比较安全

**个人见解：** 这种对于 **服务端渲染**的 `php` 、 `java` 、 `C#` 这种可以通过文件上传漏洞来执行**一句话木马**这种技术来说，确实起到了一定程度的保护，因为代码无法修改数据库表结构，但是对于前后端分离的技术，无特殊情况下，后台是不会运行前端上传的代码的，这个时候似乎意义不是很大。所以，我觉得这个方案是由于之前全部是**模板引擎**的解决方案推动的。现在讲**前后分离**， `serverless` 等，无需如此。

随着开发工作流的更改，服务运行环境采用 `k8s` 这种集群，服务部署采用 `CI/CD` 这种全自动化的流程， `migration` 这种方案会显得尤为笨重。 `Code First` 的方式通过代码直接修改表结构的方式非常的适合容器化环境。

我从 `Prisma2` 版本开始接触，官方网站上非常明显的引导使用 `migration` ，按照官方文档的意思， `migration` 是它的一大亮点。对于从 `Java` 、 `C#` 过来的道友来说，可能确实是。本人一直是 `node` 体系，之前是 `typeorm` 技术栈，对于 `migration` 并不感冒，反而觉得啰嗦。

因此最佳实践采用 `Code First` 方式。部署前只需要执行一下 `push` 语句就行了，具体可以参考笔记：[表结构同步](表结构同步/README.md)
