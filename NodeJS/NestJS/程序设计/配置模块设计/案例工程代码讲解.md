# NestJS 配置模块案例工程代码讲解

## 案例工程地址

* [个人Gitlab](https://git.virtualbing.cn/nestjs-demo/nestjs-config)
* [GitHub](https://github.com/IricBing/nestjs-config)

## 项目结构

``` shell
$ tree -a   # 已删除 .git 文件夹
nestjs-config
    ├── docker-compose.yml
    ├── Dockerfile
    ├── .dockerignore
    ├── .env.development
    ├── .eslintrc.js
    ├── .gitignore
    ├── nest-cli.json
    ├── .nvmrc
    ├── package.json
    ├── .prettierrc
    ├── README.md
    ├── src
    │   ├── app.module.ts
    │   ├── main.ts
    │   └── modules
    │       └── config
    │           ├── config.module.ts
    │           ├── constants
    │           │   └── config.constant.ts
    │           ├── registers
    │           │   ├── common.register.ts
    │           │   ├── database.register.ts
    │           │   └── redis.register.ts
    │           ├── services
    │           │   └── config.service.ts
    │           └── validations
    │               └── config.validation.ts
    ├── test
    │   ├── app.e2e-spec.ts
    │   └── jest-e2e.json
    ├── tsconfig.build.json
    ├── tsconfig.build.prod.json
    ├── tsconfig.json
    ├── .vscode
    │   ├── launch.json
    │   └── settings.json
    ├── yarn.lock
    └── .yarnrc

9 directories, 29 files
```

按照文档，先生成本地配置文件

``` shell
$ cp .env.development .env
```

主要讲解 `src` 文件夹下的文件，其他文件参考[nestjs工程配置](../../工程配置/README.md)

``` shell
$ tree -a 
src
├── app.module.ts   # 主模块
├── main.ts     # 项目入口文件
└── modules 
    └── config
        ├── config.module.ts    # 自定义Config模块声明文件
        ├── constants       
        │   └── config.constant.ts  # config 模块常量文件
        ├── registers
        │   ├── common.register.ts  # 公共配置注册文件
        │   ├── database.register.ts    # 数据库（Postgresql）配置注册文件
        │   └── redis.register.ts   # Redis配置注册文件
        ├── services
        │   └── config.service.ts   # 自定义配置服务
        └── validations
            └── config.validation.ts    # 配置校验

6 directories, 9 files
```

## 功能实现

### 配置校验功能

项目一般都会依赖一些必要的配置才能正常运行，比如项目需要连接数据库，然而配置文件中没有数据库的连接地址，那么项目就不应该启动，而是在启动前直接报错，退出。
