# NestJS 插件开发步骤

## Step1. 新建项目

``` shell
$ nest new nestjs-mp-cluster
```

## Step2. 修改package.json文件

在 `package.json` 文件中增加如下配置：

``` json
{
  "files": [
    "dist/**/*"
  ],
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "keywords": [
    "nestjs",
    "微信小程序",
    "多个微信小程序",
    "typescript"
  ],
}
```

`说明：` 其中 `files` , `main` , `types` 字段必填， `keywords` 可选。

修改 `script` 属性内容

``` json
{
  "scripts": {
    "build:npm": "rimraf dist && nest build -p tsconfig.npm.build.json",
    "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand"
  }
}
```

将 `dependencies` 中的依赖全部移到 `devDependencies` 中去。

## Step3. 修改tsconfig.build.json文件

将 `tsconfig.build.json` 文件改为以下内容：

``` json
{
  "extends": "./tsconfig.json",
  "exclude": [
    "node_modules",
    "test",
    "dist",
    "index.ts",
    "**/*.d.ts",
    "**/*spec.ts"
  ]
}
```

## Step4. 开发

开始开发，调试等，具体见 [开发详解](开发详解.md)

## Step5. 编译

``` shell
$ yarn build:npm
```

## Step6. 发布

`注意：` 发布之前一定要看看 `package.json` 文件中的 `version` 字段，**npm会根据这个字段给包打上版本。**

``` shell
$ npm login # 注意，需要将npm源切换回npm
$ npm publish --access=public 
```
